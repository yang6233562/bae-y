KISSY.add("waterfall/base",function(a,b,c){function g(){var b=this;g.superclass.constructor.apply(b,arguments);var c=b.__onResize=a.buffer(i,f,b);i.call(b),d(e).on("resize",c)}function h(b,c,d,e){function i(){h=[].concat(a.makeArray(b)),h.length>0?function(){var a=+new Date;do{var f=h.shift();c.call(d,f)}while(h.length>0&&+new Date-a<50);h.length>0?g=setTimeout(arguments.callee,25):e&&e.call(d,b)}():e&&e.call(d,b)}var g,h,f={};return f.stop=function(){g&&(clearTimeout(g),h=[],b.each(function(a){a.stop()}))},f.start=i,f}function i(){var b=this,c=b.get("colWidth"),d=b.get("container"),e=b._containerRegion||{};a.isFunction(c)&&(c=c(b)),!d[0].offsetWidth||b._colWidth===c&&d.width()===e.width||(b._colWidth=c,b.adjust())}function j(){var b=this,c=b.get("container"),d=c.width(),e=b._curColHeights||[];b._curColHeights=e,e.length=Math.max(Math.floor(d/b._colWidth),b.get("minColCount")),b._containerRegion={width:d},a.each(e,function(a,b){e[b]=0}),b._colItems=[]}function k(a,b,c,e){function s(b){j[n]+=g.outerHeight(!0);var c=a._colItems;c[n]=c[n]||[],c[n].push(g),g.attr("data-waterfall-col",n);var d=g[0].className.replace(/\s*ks-waterfall-col-(?:first|last|\d+)/g,"");d+=" ks-waterfall-col-"+n,0==n?d+=" ks-waterfall-col-first":n==j.length-1&&(d+=" ks-waterfall-col-last"),g[0].className=d,b||e&&e()}var i,o,f=a.get("effect"),g=d(c),h=a.get("align"),j=a._curColHeights,k=a.get("container"),l=a._colWidth,m=j.length,n=0,p=a._containerRegion,q=Number.MAX_VALUE;if(!m)return void 0;if(g.hasClass("ks-waterfall-fixed-left"))n=0;else if(g.hasClass("ks-waterfall-fixed-right"))n=m>0?m-1:0;else for(var r=0;m>r;r++)j[r]<q&&(q=j[r],n=r);if(i="left"===h?0:Math.max(p.width-m*l,0),"center"===h&&(i/=2),"justify"===h&&m>1&&(i=n>0?Math.max((p.width-l)/(m-1)-l,0)*n:0),o={left:n*l+i,top:j[n]},b)g.css(o),f&&f.effect&&g.css("visibility","hidden"),k.append(g),s();else{var t=a.get("adjustEffect");t?(s(1),g.animate(o,t.duration,t.easing,e)):(g.css(o),s())}return g}function l(a){var b=this,c=k(b,!0,a),d=b.get("effect");c&&d&&d.effect&&(c.hide(),c.css("visibility",""),c[d.effect](d.duration,0,d.easing))}var d=b.all,e=a.Env.host,f=50;return g.ATTRS={container:{setter:function(a){return d(a)}},align:{value:"center"},minColCount:{value:1},effect:{value:{effect:"fadeIn",duration:1}},colWidth:{},adjustEffect:{}},a.extend(g,c,{isAdjusting:function(){return!!this._adjuster},isAdding:function(){return!!this._adder},adjustItem:function(a,b){function q(){p--,0>=p&&(c._adjuster=0,b.callback&&b.callback.call(c))}var c=this;if(b=b||{},c.isAdjusting())return void 0;var e,d=a.outerHeight(!0);b.process&&(e=b.process.call(c)),void 0===e&&(e=a.outerHeight(!0));for(var m,f=e-d,g=c._curColHeights,i=parseInt(a.attr("data-waterfall-col")),j=c._colItems[i],k=[],l=Math.max.apply(Math,g),n=0;n<j.length&&j[n][0]!==a[0];n++);for(n++;n<j.length;)k.push(j[n]),n++;g[i]+=f,m=Math.max.apply(Math,g),m!=l&&c.get("container").height(m);var o=b.effect,p=k.length;return p?(void 0===o&&(o=c.get("adjustEffect")),c._adjuster=h(k,function(a){o?a.animate({top:parseInt(a.css("top"))+f},o.duration,o.easing,q):(a.css("top",parseInt(a.css("top"))+f),q())}),c._adjuster.start(),c._adjuster):b.callback&&b.callback.call(c)},removeItem:function(b,c){c=c||{};var d=this,e=c.callback;d.adjustItem(b,a.mix(c,{process:function(){return b.remove(),0},callback:function(){for(var a=parseInt(b.attr("data-waterfall-col")),c=d._colItems[a],f=0;f<c.length;f++)if(c[f][0]==b[0]){c.splice(f,1);break}e&&e()}}))},adjust:function(a){function e(){d--,0>=d&&(b.get("container").height(Math.max.apply(Math,b._curColHeights)),b._adjuster=0,a&&a.call(b),b.fire("adjustComplete",{items:c}))}var b=this,c=b.get("container").all(".ks-waterfall");b.isAdjusting()&&(b._adjuster.stop(),b._adjuster=0),j.call(b);var d=c.length;return d?(b._adjuster=h(c,function(a){k(b,!1,a,e)}),b._adjuster.start(),b._adjuster):a&&a.call(b)},addItems:function(a,b){var c=this;return c._adder=h(a,l,c,function(){c.get("container").height(Math.max.apply(Math,c._curColHeights)),c._adder=0,b&&b.call(c),c.fire("addComplete",{items:a})}),c._adder.start(),c._adder},destroy:function(){var a=this,b=a.__onResize;d(e).detach("resize",b),b.stop(),a.fire("destroy"),a.__destroyed=1}}),g},{requires:["node","base"]}),KISSY.add("waterfall/loader",function(a,b,c){function g(){var b=this;g.superclass.constructor.apply(b,arguments),b.__onScroll=a.buffer(h,f,b),b.start()}function h(){var a=this;if(!a.__loading){if(a.isAdjusting())return a.__onScroll(),void 0;var b=a.get("container");if(b[0].offsetWidth){var c=b.offset().top,f=a.get("diff"),g=a._curColHeights;g.length&&(c+=Math.min.apply(Math,g)),f+d(e).scrollTop()+d(e).height()>=c&&i.call(a)}}}function i(){function d(b,c){a.__loading=0,a.addItems(b,function(){c&&c.apply(this,arguments),h.call(a)})}function e(){a.end()}var a=this;a.get("container"),a.__loading=1;var c=a.get("load");c&&c(d,e)}var d=b.all,e=a.Env.host,f=50;return g.ATTRS={diff:{value:0}},a.extend(g,c,{start:function(){this.resume()},end:function(){this.pause()},pause:function(){var a=this;a.__destroyed||(d(e).detach("scroll",a.__onScroll),a.__onScroll.stop())},resume:function(){var a=this;a.__destroyed||(d(e).on("scroll",a.__onScroll),a.__started=1,h.call(a))},destroy:function(){var a=this;a.end(),g.superclass.destroy.apply(a,arguments)}}),g},{requires:["node","./base"]}),KISSY.add("waterfall",function(a,b,c){return b.Loader=c,b},{requires:["waterfall/base","waterfall/loader"]});