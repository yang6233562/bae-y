KISSY.add("rich-base",function(S,Base){function CamelCase(a){return a.replace(RE_DASH,CAMEL_CASE_FN)}function RichBase(){var b,c,a=this;Base.apply(a,arguments),c=a.get("listeners");for(b in c)a.on(b,c[b]);a.callMethodByHierarchy("initializer","constructor"),a.constructPlugins(),a.callPluginsMethod("initializer"),a.bindInternal(),a.syncInternal()}function destroyHierarchy(a){for(var c,d,e,b=a.constructor;b;){if(b.prototype.hasOwnProperty("destructor")&&b.prototype.destructor.apply(a),c=b.__ks_exts)for(e=c.length-1;e>=0;e--)d=c[e]&&c[e].prototype.__destructor,d&&d.apply(a);b=b.superclass&&b.superclass.constructor}}function onSetAttrChange(a){var c,b=this;a.target==b&&(c=b[ON_SET+a.type.slice(5).slice(0,-6)],c.call(b,a.newVal,a))}var ATTRS="ATTRS",ucfirst=S.ucfirst,ON_SET="_onSet",noop=S.noop,RE_DASH=/(?:^|-)([a-z])/gi,CAMEL_CASE_FN=function(a,b){return b.toUpperCase()};return S.extend(RichBase,Base,{collectConstructorChains:function(){for(var a=this,b=[],c=a.constructor;c;)b.push(c),c=c.superclass&&c.superclass.constructor;return b},callMethodByHierarchy:function(a,b){for(var f,g,h,i,j,c=this,d=c.constructor,e=[];d;){if(j=[],i=d.__ks_exts)for(h=0;h<i.length;h++)f=i[h],f&&("constructor"!=b&&(f=f.prototype.hasOwnProperty(b)?f.prototype[b]:null),f&&j.push(f));d.prototype.hasOwnProperty(a)&&(g=d.prototype[a])&&j.push(g),j.length&&e.push.apply(e,j.reverse()),d=d.superclass&&d.superclass.constructor}for(h=e.length-1;h>=0;h--)e[h]&&e[h].call(c)},callPluginsMethod:function(a){var b=this;a="plugin"+ucfirst(a),S.each(b.get("plugins"),function(c){c[a]&&c[a](b)})},constructPlugins:function(){var a=this.get("plugins");S.each(a,function(b,c){S.isFunction(b)&&(a[c]=new b)})},bindInternal:function(){var c,d,a=this,b=a.getAttrs();for(c in b)d=ON_SET+ucfirst(c),a[d]&&a.on("after"+ucfirst(c)+"Change",onSetAttrChange)},syncInternal:function(){var b,c,d,e,f,g,j,a=this,h={},i=a.collectConstructorChains();for(d=i.length-1;d>=0;d--)if(e=i[d],j=e[ATTRS])for(f in j)h[f]||(h[f]=1,g=ON_SET+ucfirst(f),(c=a[g])&&j[f].sync!==!1&&void 0!==(b=a.get(f))&&c.call(a,b))},initializer:noop,destructor:noop,destroy:function(){var a=this;a.callPluginsMethod("destructor"),destroyHierarchy(a),a.fire("destroy"),a.detach()},plug:function(a){var b=this;return S.isFunction(a)&&(a=new a),a.pluginInitializer&&a.pluginInitializer(b),b.get("plugins").push(a),b},unplug:function(a){var b=[],c=this,d="string"==typeof a;return S.each(c.get("plugins"),function(e){var g,f=0;a&&(d?(g=e.get&&e.get("pluginId")||e.pluginId,g!=a&&(b.push(e),f=1)):e!=a&&(b.push(e),f=1)),f||e.pluginDestructor(c)}),c.setInternal("plugins",b),c},getPlugin:function(a){var b=null;return S.each(this.get("plugins"),function(c){var d=c.get&&c.get("pluginId")||c.pluginId;return d==a?(b=c,!1):void 0}),b}},{ATTRS:{plugins:{value:[]},listeners:{value:[]}}}),S.mix(RichBase,{extend:function extend(extensions,px,sx){var baseClass=this,name,C;if(S.isArray(extensions)||(sx=px,px=extensions,extensions=[]),sx=sx||{},name=sx.name||"RichBaseDerived",px=px||{},px.hasOwnProperty("constructor")?C=px.constructor:S.Config.debug?eval("C = function "+CamelCase(name)+"(){ "+"C.superclass.constructor.apply(this, arguments);}"):C=function(){C.superclass.constructor.apply(this,arguments)},S.extend(C,baseClass,px,sx),extensions){C.__ks_exts=extensions;var attrs={},prototype={};S.each(extensions.concat(C),function(a){if(a){S.each(a[ATTRS],function(a,b){var c=attrs[b]=attrs[b]||{};S.mix(c,a)});var c,b=a.prototype;for(c in b)b.hasOwnProperty(c)&&(prototype[c]=b[c])}}),C[ATTRS]=attrs,S.augment(C,prototype),C.prototype.constructor=C}return C.extend=extend,C}}),RichBase},{requires:["base"]});